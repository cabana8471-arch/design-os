<!-- v1.0.0 -->

# Phase 6: Finalize Export (Steps 15-18)

This phase generates the README, copies screenshots, creates the zip file, and confirms completion.

---

## Step 15: Generate README.md

Create `product-plan/README.md` with the actual product name substituted:

**Important:** Replace all `[Product Name]` placeholders with the actual product name from `product-overview.md` before writing the file.

```bash
# Get the product name from product-overview.md (first line after "# ")
PRODUCT_NAME=$(head -1 product/product-overview.md | sed 's/^# //')
```

```markdown
# [Product Name] — Design Handoff

This folder contains everything needed to implement [Product Name].

## What's Included

**Ready-to-Use Prompts:**

- `prompts/one-shot-prompt.md` — Prompt template for full implementation
- `prompts/section-prompt.md` — Prompt template for section-by-section implementation

**Instructions:**

- `product-overview.md` — Product summary (provide with every implementation)
- `instructions/one-shot-instructions.md` — All milestones combined for full implementation
- `instructions/incremental/` — Milestone-by-milestone instructions (foundation, then sections)

**Design Assets:**

- `design-guidance/` — Frontend design principles and guidance for creating distinctive components
- `design-system/` — Colors, fonts, design tokens
- `data-model/` — Core entities and TypeScript types
- `shell/` — Application shell components
- `sections/` — All section components, types, sample data, and test instructions

## How to Use This

### Option A: Incremental (Recommended)

Build your app milestone by milestone for better control:

1. Copy the `product-plan/` folder to your codebase
2. Start with Foundation (`instructions/incremental/01-foundation.md`) — includes design tokens, data model, routing, and application shell
3. For each section:
   - Open `prompts/section-prompt.md`
   - Fill in the section variables at the top (SECTION_NAME, SECTION_ID, NN)
   - Copy/paste into your coding agent
   - Answer questions and implement
4. Review and test after each milestone

### Option B: One-Shot

Build the entire app in one session:

1. Copy the `product-plan/` folder to your codebase
2. Open `prompts/one-shot-prompt.md`
3. Add any additional notes to the prompt
4. Copy/paste the prompt into your coding agent
5. Answer the agent's clarifying questions
6. Let the agent plan and implement everything

## Test-Driven Development

Each section includes a `tests.md` file with test-writing instructions. For best results:

1. Read `sections/[section-id]/tests.md` before implementing
2. Write failing tests based on the instructions
3. Implement the feature to make tests pass
4. Refactor while keeping tests green

The test instructions are **framework-agnostic** — they describe WHAT to test, not HOW. Adapt to your testing setup (Jest, Vitest, Playwright, Cypress, RSpec, Minitest, PHPUnit, etc.).

## Tips

- **Use the pre-written prompts** — They include important clarifying questions about auth and data modeling.
- **Add your own notes** — Customize prompts with project-specific context when needed.
- **Build on your designs** — Use completed sections as the starting point for future feature development.
- **Review thoroughly** — Check plans and implementations carefully to catch details and inconsistencies.
- **Fill in the gaps** — Backend business logic may need manual additions. Incremental implementation helps you identify these along the way.

---

_Generated by Design OS_
```

## Step 16: Copy Screenshots

Copy any `.png` files from:

- `product/shell/` → `product-plan/shell/`
- `product/sections/[section-id]/` → `product-plan/sections/[section-id]/`

### Screenshot Copying with Reporting

Track which screenshots exist and were copied. Report the results to the user:

**Step 1: Check for shell screenshots**

```bash
if ls product/shell/*.png 1> /dev/null 2>&1; then
  cp product/shell/*.png product-plan/shell/
  echo "Copied shell screenshots"
else
  echo "Note: No shell screenshots found in product/shell/"
fi
```

**Step 2: Check for section screenshots**
For each section, check and report:

```bash
for section in product/sections/*/; do
  section_id=$(basename "$section")
  if ls "$section"*.png 1> /dev/null 2>&1; then
    cp "$section"*.png "product-plan/sections/$section_id/"
    echo "Copied screenshots for section: $section_id"
  else
    echo "Note: No screenshots found for section: $section_id"
  fi
done
```

**Step 2.5: Validate screenshot filenames**

After copying, validate that screenshot filenames follow the naming convention. This helps ensure consistent documentation.

**Expected naming convention:** `[screen-design-name].png` or `[screen-design-name]-[variant].png`

Valid examples:

- `invoice-list.png` (main view)
- `invoice-list-dark.png` (dark mode variant)
- `invoice-detail-mobile.png` (mobile variant)
- `dashboard-empty.png` (empty state)

Invalid examples:

- `screenshot1.png` (non-descriptive)
- `Screen Shot 2024-01-15.png` (system default name)
- `IMG_1234.png` (camera roll naming)

```bash
# Validate screenshot filenames in each section
for section in product-plan/sections/*/; do
  section_id=$(basename "$section")
  for png in "$section"*.png 2>/dev/null; do
    [ -f "$png" ] || continue
    filename=$(basename "$png")
    # Check if filename matches expected pattern: lowercase, hyphens, optional variant suffix
    if [[ ! "$filename" =~ ^[a-z][a-z0-9-]*\.png$ ]]; then
      echo "Warning: Screenshot '$filename' in $section_id doesn't follow naming convention."
      echo "  Expected format: [screen-design-name].png or [screen-design-name]-[variant].png"
    fi
  done
done
```

If warnings are reported, inform the user but continue with the export:

```
Note: Some screenshot filenames don't follow the naming convention.
Consider renaming them to match the pattern: [screen-design-name]-[variant].png
This improves documentation consistency but doesn't block the export.
```

**Step 3: Report summary**
After copying, provide a summary:

```
Screenshot Summary:
- Shell: [Copied / Not found]
- Section [section-1]: [Copied / Not found]
- Section [section-2]: [Copied / Not found]
...
```

**If no screenshots exist for any section:**

```
Warning: No screenshots were found for export.
The sections/[section-id]/ folders will not include visual references.
Consider running /screenshot-design for each section to capture screenshots.
```

This ensures users know which sections have visual documentation and which may need screenshots captured.

## Step 17: Create Zip File

After generating all the export files, create a zip archive of the product-plan folder.

### Validate Zip Command Exists

First, check if the `zip` command is available on the system:

```bash
if ! command -v zip &> /dev/null; then
  echo "Warning: 'zip' command not found. Skipping zip creation."
  echo "The export folder is still available at product-plan/"
  echo "To create a zip manually, install zip and run: zip -r product-plan.zip product-plan/"
fi
```

If `zip` is not available, skip zip creation but continue with the export. The `product-plan/` folder is still fully functional.

### Create the Zip Archive

If `zip` is available:

```bash
# Check if existing zip file exists and ask before removing
if [ -f "product-plan.zip" ]; then
  echo "Note: Existing product-plan.zip found. It will be replaced with the new export."
fi

# Remove any existing zip file
rm -f product-plan.zip

# Create the zip file
cd . && zip -r product-plan.zip product-plan/

# Verify zip was created and is valid
if [ -f "product-plan.zip" ]; then
  zip_size=$(du -h product-plan.zip | cut -f1)
  echo "Zip archive created: product-plan.zip ($zip_size)"
else
  echo "Error: Zip file not created. Check product-plan/ folder."
fi
```

### Validate Zip Contents

After creating the zip, verify it contains the expected structure:

```bash
# Validate zip is not corrupted
if ! unzip -t product-plan.zip > /dev/null 2>&1; then
  echo "Error: product-plan.zip - Zip file is corrupted. Recreating..."
  rm -f product-plan.zip
  zip -r product-plan.zip product-plan/
fi

# Check zip contains expected files
EXPECTED_FILES=(
  "product-plan/README.md"
  "product-plan/product-overview.md"
  "product-plan/prompts/one-shot-prompt.md"
)

for expected in "${EXPECTED_FILES[@]}"; do
  if ! unzip -l product-plan.zip | grep -q "$expected"; then
    echo "Warning: Zip missing expected file: $expected"
  fi
done

# Report zip contents summary
file_count=$(unzip -l product-plan.zip | tail -1 | awk '{print $2}')
echo "Zip contains $file_count files"
```

**Validation Criteria:**

| Check             | Pass Criteria                   | On Failure          |
| ----------------- | ------------------------------- | ------------------- |
| Zip exists        | `product-plan.zip` file present | Retry zip creation  |
| Zip not empty     | File size > 0 bytes             | Retry zip creation  |
| Zip not corrupted | `unzip -t` passes               | Delete and recreate |
| Contains README   | README.md in zip listing        | Warning only        |
| Contains prompts  | prompts/ directory present      | Warning only        |

### Zip Cleanup Behavior

The previous zip file is always replaced during export. This is intentional because:

- Each export represents a complete, updated snapshot
- Keeping old zips could cause confusion about which version to use
- The product-plan/ folder is always preserved for comparison

**If you need to preserve old exports:**

- Rename the existing zip before running export: `mv product-plan.zip product-plan-backup.zip`
- Or use version control to track export history

This creates `product-plan.zip` in the project root, which will be available for download on the Export page.

## Step 18: Confirm Completion

Let the user know:

"I've created the complete export package at `product-plan/` and `product-plan.zip`.

**What's Included:**

**Ready-to-Use Prompts:**

- `prompts/one-shot-prompt.md` — Prompt for full implementation
- `prompts/section-prompt.md` — Prompt template for section-by-section

**Instructions:**

- `product-overview.md` — Product summary (always provide with instructions)
- `instructions/one-shot-instructions.md` — All milestones combined
- `instructions/incremental/` — [N] milestone instructions (foundation, then sections)

**Design Assets:**

- `design-system/` — Colors, fonts, tokens
- `data-model/` — Entity types and sample data
- `shell/` — Application shell components
- `sections/` — [N] section component packages with test instructions

**Download:**

Restart your dev server and visit the Export page to download `product-plan.zip`.

**How to Use:**

1. Copy `product-plan/` to your implementation codebase
2. Open `prompts/one-shot-prompt.md` or `prompts/section-prompt.md`
3. Add any additional notes, then copy/paste into your coding agent
4. Answer the agent's clarifying questions about auth, data modeling, etc.
5. Let the agent implement based on the instructions

The components are props-based and portable — they accept data and callbacks, letting your implementation agent handle routing, data fetching, and state management however fits your stack."

## Important Notes

- Always transform import paths when copying components
- Include `product-overview.md` context with every implementation session
- Use the pre-written prompts — they prompt for important clarifying questions
- Screenshots provide visual reference for fidelity checking
- Sample data files are for testing before real APIs are built
- The export is self-contained — no dependencies on Design OS
- Components are portable — they work with any React setup

### Rollback / Recovery

If the export process fails or produces unexpected results, here's how to recover:

**Before Starting Export (Recommended):**

Create a backup of any existing export before starting a new one:

```bash
# Backup existing export folder
if [ -d "product-plan" ]; then
  mv product-plan product-plan-backup-$(date +%Y%m%d-%H%M%S)
fi

# Backup existing zip file
if [ -f "product-plan.zip" ]; then
  mv product-plan.zip product-plan-backup-$(date +%Y%m%d-%H%M%S).zip
fi
```

**If Export Fails Mid-Process:**

1. **Delete the partial export:**

   ```bash
   rm -rf product-plan/
   rm -f product-plan.zip
   ```

2. **Fix the issue** (usually a validation error from Step 1 or Step 8)

3. **Re-run `/export-product`** — the command is idempotent and will recreate everything

**If Export Completes But Has Issues:**

| Problem             | Solution                                                                                  |
| ------------------- | ----------------------------------------------------------------------------------------- |
| Missing components  | Check Step 8-9 logs for validation failures. Re-run export after fixing component issues. |
| Wrong import paths  | Check Step 9 path transformations. May need to manually fix paths in copied files.        |
| Missing screenshots | Run `/screenshot-design` for each section, then re-run export.                            |
| Corrupt prompts     | Check template files in `.claude/templates/design-os/`. Restore from git if needed.       |
| Zip file corrupt    | Delete `product-plan.zip` and recreate manually: `zip -r product-plan.zip product-plan/`  |

**Restore from Backup:**

If you have a backup and need to restore:

```bash
# Remove failed export
rm -rf product-plan/
rm -f product-plan.zip

# Restore from backup
mv product-plan-backup-[timestamp] product-plan
mv product-plan-backup-[timestamp].zip product-plan.zip
```

**Git-Based Recovery:**

If the export folder is tracked in git:

```bash
# Discard all changes to product-plan/
git checkout -- product-plan/

# Or restore specific files
git checkout HEAD -- product-plan/prompts/one-shot-prompt.md
```

**When to Start Fresh:**

Sometimes it's easier to delete everything and regenerate:

```bash
rm -rf product-plan/
rm -f product-plan.zip
# Then re-run /export-product
```

The export process is designed to be repeatable — running it multiple times will produce the same output (given the same source files).

### Progress Reporting

During the export process, provide progress updates to keep the user informed:

**Report at the start of each major step:**

```
[Step X/18] Starting: [Step Name]...
```

**Report after completing key milestones:**

```
[DONE] Step 3: Created export directory structure
[DONE] Step 4: Generated product-overview.md
[DONE] Step 5-6: Generated milestone instructions (4 milestones)
[DONE] Step 8: Validated all components (12 components, 0 issues)
[DONE] Step 9: Copied and transformed components
...
```

**For long-running steps, report progress within the step:**

```
[Step 9] Copying section components...
  - invoices: 3 components copied
  - projects: 4 components copied
  - reports: 2 components copied
```

**Summary at completion:**

```
Export Complete!
- Total steps: 18
- Milestones generated: 4
- Components exported: 9
- Screenshots copied: 3
- Zip file: product-plan.zip (2.4MB)
```

This helps users understand what's happening during longer exports and provides confidence that the process is progressing correctly.

### Performance Note

This command performs many file operations and may take longer for products with many sections. The most resource-intensive steps are:

- **Component validation** (Step 8) — Reads and validates all component files
- **Prompt generation** (Step 14) — Reads and assembles multiple template files
- **Zip creation** (Step 17) — Creates archive of entire export folder

For large products (5+ sections), expect this command to take more time. Progress updates are provided throughout.
